<template>
    <div>
        <div class="left-form">
            <div class="file-form">
                <div class="file-form-item">
                    <div class="left">
                    </div>
                    <div class="right">
                        <div class="title"><span><span style="color: red;">*</span> {{ title }}</span></div>
                        <div class="upload">
                            <div class="file-list">
                                <div class="item" v-for="(item, index) in fileList" :key="index">
                                    <div class="file-icon"><img src="../../../assets/file_icon.png" alt="" srcset=""></div>
                                    <span class="span">{{ item.title }}.{{ item.type }}</span>
                                    <div class="delete" style="width: 20px;margin-right: 10px;" @click="deleteFile(item,index)"><img style="width: 100%;" src="../../../assets/delete_icon.png" alt="" srcset=""></div>
                                    <div style="font-size: 22px;" @click="seeDetail(item,index)"><i class="el-icon-zoom-in"></i></div>
                                </div>
                            </div>
                            <div class="upload-btn">
                                <div class="btn" v-if="type=='add'">
                                    <img class="img" src="../../../assets/upload_icon.png" alt="" srcset="">
                                    <el-upload class="upload-demo" :action="uploadUrl"
                                        :headers="headers"
                                        :show-file-list="false" :limit="3" :on-exceed="handleExceed" :file-list="fileList"
                                        :on-progress="handleProgress"
                                        
                                        :on-success="handleSuccess">
                                        <div style="display: flex;flex-direction: row;align-items: center;" >
                                            <div class="upload">
                                                <span class="span">上传文件</span>
                                            </div>
                                        </div>
                                    </el-upload>
                                </div>
                                <span>支持扩展名: .rar .zip .doc 、docx .pdf.jpg..</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>


<script>
import { getToken } from '@/utils/auth'
export default {
    props: {
        type:{
            type:String,
            default:'add'
        },
        title: {
            type:String,
            default:'test'
        },
        fileList: {
            type:Array,
            default:()=>[]
        },
    },
    
    data() {
        return {

        }
    },
    computed:{
        uploadUrl(){
            return  process.env.VUE_APP_UPLOAD_API+'/user/upload_file'
        },
        headers(){
            return {
                "Authorization":`Bearer ${getToken()}`
            }
        }
    },
    methods:{
        seeDetail(item,index){
            if(item.url){
                window.open(item.url)
            }
        },
        deleteFile(item,index){
            // this.fileList.splice(index,1)
            this.$emit('updateFile',index)
        },
        handleExceed(files, fileList) {
            this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
        },
        handleProgress(e, file, fileList) {
            // console.log(e, file, fileList)
        },
        handleSuccess(e, file, fileList){
            console.log(e, file, fileList,'----')
            if(e.code===200){
                e.data.title = e.data.file_name;
                this.$emit('updateFile',e.data)
                // this.fileList.push(e.data);
            }
        }
    }
}
</script>

<style lang="scss" scoped>
// @import url('../mixins.scss');
.left-form{
.file-form {
    .file-form-item {
      display: flex;
      flex-direction: row;
      margin-bottom: 40px;

      .left {
        width: 1px;
        .title {
          color: #404659;
          font-size: 14px;
          font-weight: 600;
          margin-bottom: 14px;
        }
      }

      .right {
        width: 100%;
        box-sizing: border-box;

        .title {
          color: #404659;
          font-size: 14px;
          font-weight: 600;
          margin-bottom: 14px;
        }

        .upload {
          display: flex;
          flex-direction: column;

          .file-list {
            display: flex;
            flex-direction: column;

            .item {
              display: flex;
              flex-direction: row;
              align-items: center;
              flex-wrap: nowrap;
              margin-bottom: 13px;

              .file-icon {
                width: 18px;
                height: 15px;
                margin-right: 10px;
                img{
                  width: 100%;
                }
              }

              .span {
                color: #404659;
                font-size: 16px;
                margin-right: 12px;
              }

              .delete {
               
              }
            }
          }

          .upload-btn {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #A6A9BC;
            flex-direction: row;

            .btn {
              width: 100px;
              height: 36px;
              border: 1px solid #2D6CFF;
              border-radius: 4px;
              margin-right: 19px;
              font-size: 12px;
              color: #404659;
              display: flex;
              justify-content: center;
              align-items: center;
              .upload-demo{
                display: flex;
                justify-content: row;
                align-items: center;
              }
              .img{
                margin-right: 6px;
              }
            }
            .span{
              font-size: 12px;
              color: #A6A9BC;
              padding-top: 2px;
            }
          }
        }
      }

    }
  }
}
</style>